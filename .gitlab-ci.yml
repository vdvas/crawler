stages:
 - build
 - test
 - deploy
#variables:
#  crawler_dir=search_engine_crawler
build_1:
  stage: build
  image: docker:stable
  services:
    - docker:dind
  script:
    - cd search_engine_crawler
    - docker build -t name .
  artifacts:
#    image: $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
    paths:
      - docker-name_1

build_2:
  stage: build
  image: docker:stable
  services:
    - docker:dind
  script:
    - docker build -t name ./search_engine_crawler
  artifacts:
    paths:
      - docker-name-2

build_3:
  stage: build
  image: docker:stable
  script:
    - docker build -t name ./search_engine_crawler
  artifacts:
#    image: $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
    paths:
      - docker-name-3

test_crawler_job:
 stage: test
 image: python:3.6
 script:
   - cd search_engine_crawler
   - pip install -r requirements.txt -r requirements-test.txt
   - python -m unittest discover -s tests/
   - coverage run -m unittest discover -s tests/
   - coverage report --include crawler/crawler.py

test_ui_job:
 stage: test
 image: python:3.6
 script:
   - cd search_engine_ui
   - pip install -r requirements.txt -r requirements-test.txt
   - python -m unittest discover -s tests/ 
   - coverage run -m unittest discover -s tests/ 
   - coverage report --include ui/ui.py
